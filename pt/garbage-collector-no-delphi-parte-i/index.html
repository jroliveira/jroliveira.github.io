<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="Cache-Control" content="max-age=604800"><title>Garbage Collector no Delphi - Parte I ~ Junior Oliveira</title><meta name="viewport" content="width=device-width"><meta name="author" content="Junior Oliveira"><meta name="title" content="Garbage Collector no Delphi - Parte I ~ Junior Oliveira"><meta name="description" content="Blog about code and stuff."><meta name="keywords" content="delphi"><meta name="robots" content="index, follow"><meta name="theme-color" content="#C1A8B2"><meta property="og:type" content="article"><meta property="og:site_name" content="Junior Oliveira"><meta property="og:url" content="https://jroliveira.net"><meta property="og:title" content="Garbage Collector no Delphi - Parte I ~ Junior Oliveira"><meta property="og:description" content="Blog about code and stuff."><link rel="icon" href="/assets/images/favicon.png" async><link rel="manifest" href="/manifest.json" async><link rel="stylesheet" href="/assets/styles/main.70161d.css" async><script async defer>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-11448040-10","auto"),ga("send","pageview")</script><script async defer rel="preconnect" src="https://www.google-analytics.com/analytics.js"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/feed.xml" title="Junior Oliveira" type="application/rss+xml">
</head><body><header class="site-header"><div class="page__container"><a class="site-branding" href="/"><img class="site-branding__logo" src="/assets/images/favicon.svg" alt="Junior Oliveira's blog"><h1 class="site-branding__title--full">Junior Oliveira</h1><h1 class="site-branding__title--short">Jr Oliveira</h1></a><ul class="menu"><li class="menu-item"><a class="menu-item__icon" href="/x-wing" title="Star Wars: X-Wing"><i class="xwing-miniatures-font xwing-miniatures-font-coordinate"></i></a></li><li class="menu-item"><small>&nbsp; | &nbsp;</small></li><li class="menu-item"><a class="menu-item__icon fas fa-search" href="/search" title="Pesquisar posts"></a></li></ul></div></header><main class="site-main"><div class="page__container"><article><h2 class="page__title">Garbage Collector no Delphi - Parte I<p class="post__meta"><small>29 de dezembro de 2010 </small><small>&nbsp; | &nbsp;</small> <small><i class="fas fa-comments"></i>&nbsp; <a href="#disqus_thread"></a> </small><small>&nbsp; | &nbsp;</small> <small><i class="fas fa-tags"></i>&nbsp; <a href="/tags/delphi/">delphi</a> </small><small>&nbsp; | &nbsp;</small> <small><i class="fas fa-globe"></i>&nbsp; <a class="text--uppercase" href="/pt/garbage-collector-no-delphi-parte-i/">pt</a></small></p></h2><div class="page__content"><p>Olá pessoal, depois de algum tempo sem postar venho com uma novidade para vocês, para alguns isto pode não ser novidade, mas tenho certeza que para outros é, pelo menos para mim foi novidade, programo em Delphi desde 2005 mais ou menos e fiquei sabendo que o Delphi tinha <strong>Garbage Collector</strong> só a dias atrás então resolvi criar uma implementação de exemplo.</p><span id="more"></span><p>Neste primeiro exemplo vou trabalhar apenas com objetos que herdam de uma classe <strong>Super Classe</strong>.</p><p>A primeira implementação é da <strong>Super Classe</strong> na qual todas as outras classes irá herdá-la, a classe é bem simples ela tem uma interface do <strong>IModel</strong> que é do mesmo tipo da <strong>IUnknown</strong> que será responsável por dizer que o objeto será liberado automaticamente e a classe <strong>TModel</strong> é quem irá herdar <strong>TInterfacedObject</strong> e a inteface <strong>IUnknown</strong>.</p><figure class="highlight delphi"><figcaption><span>TModel.pas</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unit</span> Model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span></span><br><span class="line">  IModel = <span class="keyword">type</span> IUnknown;</span><br><span class="line"></span><br><span class="line">  <span class="title">TModel</span> = <span class="keyword">class</span>(TInterfacedObject, IModel)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">implementation</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure><p>A segunda implementação é da <strong>Sub Classe</strong>, ela irá conter uma interface que irá conter todos os métodos necessários na classe principal e uma classe que irá herdar a <strong>Super Classe</strong> e implementar a classe que contém os métodos que serão usados na classe.<br>Note que na frente da declaração do método <strong>Destroy</strong> existe um <strong>override</strong> pois o mesmo está declarado como <strong>virtual</strong> na classe <strong>TObject</strong> o que indica que o mesmo pode ser sobrescrito na <strong>Sub Classe</strong>.</p><figure class="highlight delphi"><figcaption><span>TModelPessoa.pas</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unit</span> ModelPessoa;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">uses</span></span><br><span class="line">  Dialogs, Model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span></span><br><span class="line">  IModelPessoa = <span class="keyword">interface</span></span><br><span class="line">    <span class="function"><span class="keyword">procedure</span> <span class="title">Teste</span><span class="params">()</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title">TModelPessoa</span> = <span class="keyword">class</span>(TModel, IModelPessoa)</span><br><span class="line">  <span class="keyword">public</span></span><br><span class="line">    <span class="comment">&#123; Public declarations &#125;</span></span><br><span class="line">    <span class="function"><span class="keyword">constructor</span> <span class="title">Create</span><span class="params">()</span>;</span></span><br><span class="line">    <span class="function"><span class="keyword">destructor</span> <span class="title">Destroy</span><span class="params">()</span>;</span> <span class="keyword">override</span>;</span><br><span class="line">    <span class="function"><span class="keyword">procedure</span> <span class="title">Teste</span><span class="params">()</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">implementation</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&#123; TModelPessoa &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">constructor</span> <span class="title">TModelPessoa</span>.<span class="title">Create</span><span class="params">()</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  ShowMessage(<span class="string">&#x27;Create&#x27;</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">destructor</span> <span class="title">TModelPessoa</span>.<span class="title">Destroy</span><span class="params">()</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  ShowMessage(<span class="string">&#x27;Destroy&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">inherited</span> Destroy();</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">TModelPessoa</span>.<span class="title">Teste</span><span class="params">()</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  ShowMessage(<span class="string">&#x27;Teste&#x27;</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure><p>Pronto agora é só usar mos, primeiro temos que criar uma variável do tipo da interface da <strong>Sub Classe</strong>, pois é que o coletor ficará verificando e quando a mesma sair do contexto será capturado automaticamente pelo <strong>Garbage Collector</strong>. Depois vamos instanciar esta variável pela classe concreta que implementa a nossa interface para podermos usar o objeto, note que ao instanciar o objeto irá aparecer a mensagem <em>“Create”</em>, apos executar pelo método <strong>Teste()</strong> irá aparecer a mensagem <em>“Teste”</em> e por final quando terminar o método principal na qual foi declarada a variável do tipo da interface da <strong>Sub Classe</strong> irá aparecer a mensagem <em>“Destroy”</em> que indicará que a nossa variável foi liberada da memória pelo <strong>Garbage Collector</strong> do Delphi.</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span></span><br><span class="line">  objPessoa: IModelPessoa;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  objPessoa := TModelPessoa.Create();</span><br><span class="line">  objPessoa.Teste();</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><p>Este exemplo foi feito em Delphi XE, caso queria mais uma forma de verificar se a variável foi realmente liberada da memória o Delphi XE tem a propriedade <strong>ReportMemoryLeaksOnShutdown</strong> que mostra os objetos que ainda estão na memória.<br>Segue abaixo uma forma de usar esta propriedade.</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> Estudo11;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uses</span></span><br><span class="line">  Forms,</span><br><span class="line">  Unit8 <span class="keyword">in</span> <span class="string">&#x27;Unit8.pas&#x27;</span> <span class="comment">&#123;Form8&#125;</span>,</span><br><span class="line">  Model <span class="keyword">in</span> <span class="string">&#x27;Model.pas&#x27;</span>,</span><br><span class="line">  ModelPessoa <span class="keyword">in</span> <span class="string">&#x27;ModelPessoa.pas&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">&#123;$R *.res&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  ReportMemoryLeaksOnShutdown := True;</span><br><span class="line"></span><br><span class="line">  Application.Initialize;</span><br><span class="line">  Application.MainFormOnTaskbar := True;</span><br><span class="line">  Application.CreateForm(TForm8, Form8);</span><br><span class="line">  Application.Run;</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure><p>Espero que este exemplo seja útil a vocês de alguma forma, até a próxima.</p></div></article><aside><div id="disqus_thread"></div><script type="text/javascript" async defer>var disqus_shortname="jroliveira";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script id="dsq-count-scr" src="//jroliveira.disqus.com/count.js" async defer></script><noscript>Please enable JavaScript to view the <a target="_blank" href="https://disqus.com/?ref_noscript" rel="nofollow noopener">comments powered by Disqus.</a></noscript></aside></div></main><footer class="site-footer"><div class="page__container"><div class="row"><div class="six columns"><ul class="social-networks-list"><li class="social-network-item"><a href="//500px.com/jr_oliveira" target="_blank" rel="noopener"><img class="social-network-item__icon" src="/assets/images/social-networks/500px.svg" alt="Junior Oliveira's 500px"> <span class="social-network-item__name">500px.com/jr_oliveira</span></a></li><li class="social-network-item"><a href="//instagram.com/junr.oliveira" target="_blank" rel="noopener"><img class="social-network-item__icon" src="/assets/images/social-networks/instagram.svg" alt="Junior Oliveira's instagram"> <span class="social-network-item__name">instagram.com/junr.oliveira</span></a></li><li class="social-network-item"><a href="//twitter.com/junr_oliveira" target="_blank" rel="noopener"><img class="social-network-item__icon" src="/assets/images/social-networks/twitter.svg" alt="Junior Oliveira's twitter"> <span class="social-network-item__name">twitter.com/junr_oliveira</span></a></li><li class="social-network-item"><a href="//linkedin.com/in/junior-oliveira" target="_blank" rel="noopener"><img class="social-network-item__icon" src="/assets/images/social-networks/linkedin.svg" alt="Junior Oliveira's linkedin"> <span class="social-network-item__name">linkedin.com/in/junior-oliveira</span></a></li><li class="social-network-item"><a href="//github.com/jroliveira/" target="_blank" rel="noopener"><img class="social-network-item__icon" src="/assets/images/social-networks/github.svg" alt="Junior Oliveira's github"> <span class="social-network-item__name">github.com/jroliveira</span></a></li></ul></div><div class="six columns"><div class="tag-cloud"><a href="/tags/delphi/" title="8" style="font-size:112%">delphi</a> <a href="/tags/rtti/" title="2" style="font-size:88%">rtti</a> <a href="/tags/ux/" title="1" style="font-size:84%">ux</a> <a href="/tags/datasnap/" title="2" style="font-size:88%">datasnap</a> <a href="/tags/jquery/" title="1" style="font-size:84%">jquery</a> <a href="/tags/json/" title="3" style="font-size:92%">json</a> <a href="/tags/php/" title="1" style="font-size:84%">php</a> <a href="/tags/generics/" title="2" style="font-size:88%">generics</a> <a href="/tags/csharp/" title="10" style="font-size:120%">csharp</a> <a href="/tags/solid/" title="1" style="font-size:84%">solid</a> <a href="/tags/tdd/" title="2" style="font-size:88%">tdd</a> <a href="/tags/di/" title="2" style="font-size:88%">di</a> <a href="/tags/ioc/" title="2" style="font-size:88%">ioc</a> <a href="/tags/nhibernate/" title="1" style="font-size:84%">nhibernate</a> <a href="/tags/singleton/" title="1" style="font-size:84%">singleton</a> <a href="/tags/design-pattern/" title="1" style="font-size:84%">design-pattern</a> <a href="/tags/jekyll/" title="1" style="font-size:84%">jekyll</a> <a href="/tags/simpledata/" title="1" style="font-size:84%">simpledata</a> <a href="/tags/nancy/" title="1" style="font-size:84%">nancy</a></div></div></div></div></footer><noscript><p>Please enable JavaScript on your browser</p></noscript><script async defer type="text/javascript">"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js").catch(console.warn)</script></body></html>